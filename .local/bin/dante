#!/bin/bash
# # Allow only root to run this script
# [ "$(id -u)" != "0" ] && echo "Root privileges required" 1>&2 && exit 1

# Check internet connection
[ -z "$(nmcli connection show --active)" ] && \
		sudo -u seongbin DISPLAY=:0 \
		DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus \
			notify-send -t 3000 "[ERROR]" "No network connection" && \
		exit 1

# ether=
# wifi=wlp58s0
NAME=Polytechnique
UUID=3b799773-71ce-498e-a83f-e979b5147236
VPN="$(nmcli -g "TYPE" connection show --active | grep -oP 'vpn')"
if [ -n "$VPN" ]
then
	ans=$(echo -e "no\nYes" | dmenu -i -p "Disconnect $NAME? [n/Y]")
	[ "$ans" = "Yes" ] && nmcli connection down "$UUID" && \
		sudo -u seongbin DISPLAY=:0 \
		DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus \
		notify-send -i /home/seongbin/.config/dunst/network-workgroup.png \
			"VPN logout" "$NAME disconnected"

else
	pass show dante | xclip -r -sel primary
	sudo -u $(users) nmcli connection up "$UUID" 2> /dev/null &
	# Clear xclip primary after 15s
	sleep 15 && \
		sudo -u seongbin DISPLAY=:0 \
		DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus \
			notify-send -t 1000 'byblis' && \
			xclip -sel primary /dev/null &
fi
