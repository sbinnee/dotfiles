#!/bin/sh
# hypr_ddspawn_v2
cls="Alacritty"
subcls="$1"  # ex) lf, term, note
cmd="$2"
geometry=${3:-"80x24"}  # 726, 530; 1920, 1080

window_info="$(hyprctl -j clients | jq -e --arg cls "$cls-$subcls" 'map(select(.class == $cls))[0]')"
if [ "$?" = 0 ]
then
    # echo "Window exists"
    pinned="$(echo "$window_info" | jq '.pinned')"
    if [ "$pinned" = "true" ]
    then
        # hide
        hyprctl dispatch movewindowpixel "0 -500,$cls-$subcls"
        sleep 0.1
        hyprctl --batch "dispatch pin $cls-$subcls ; dispatch movetoworkspacesilent special:$subcls,$cls-$subcls"
        # hyprctl dispatch pin "$cls-$subcls"  # toggle, pin off
        # hyprctl dispatch movetoworkspacesilent "special:$subcls,$cls-$subcls"
        # sleep 0.2
    else
        # show
        x="$(echo "$window_info" | jq '.at[0]')"
        y="$(echo "$window_info" | jq '.at[1]')"
        width="$(echo "$window_info" | jq '.size[0]')"
        height="$(echo "$window_info" | jq '.size[1]')"
        echo $size
        curr_ws="$(hyprctl -j activeworkspace | jq '.id')"
        hyprctl --batch "dispatch pin $cls-$subcls ; dispatch movetoworkspacesilent $curr_ws,$cls-$subcls ; dispatch movewindowpixel exact $x $(( y + 500 )),$cls-$subcls"
        # hyprctl --batch "dispatch pin $cls-$subcls ; dispatch movetoworkspacesilent $curr_ws,$cls-$subcls ; dispatch movewindowpixel exact $(( (1920 - width)/2 )) $(( (1080 - height)/2 )),$cls-$subcls"
        # hyprctl dispatch movewindowpixel exact "$(( (1920 - width)/2 )) $(( (1080 - height)/2 )),$cls-$subcls"
        # hyprctl dispatch pin "$cls-$subcls"  # toggle, pin on
        # hyprctl dispatch movetoworkspace "$curr_ws,$cls-$subcls"
        sleep 0.1
        hyprctl dispatch focuswindow "$cls-$subcls"  # make sure it's focused
    fi
else
    # echo "Window doesn't exist"
    # 112x27
    columns=${geometry%%x*}
    lines=${geometry##*x}
    if [ -n "$cmd" ]
    then
        alacritty --class "$cls-$subcls" -o "window.dimensions.columns=$columns" "window.dimensions.lines=$lines" -e $cmd &
    else
        alacritty --class "$cls-$subcls" -o "window.dimensions.columns=$columns" "window.dimensions.lines=$lines" &
    fi
fi
